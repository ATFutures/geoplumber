<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>geoplumber front ReactLeaflet standalone example</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.4.0/leaflet.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.4.0/leaflet.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/16.5.2/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/16.5.2/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-leaflet/2.2.1/react-leaflet.min.js"></script>
    <style>
      body {
        padding: 0;
      }
      .leaflet-container {
        height: 600px;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id="container"></div>
    <script type="text/babel" data-presets="es2015,react">
      const React = window.React
      const { Map, TileLayer, Marker, Popup, GeoJSON } = window.ReactLeaflet

      const geojson = null;

      class GeoJSONComponent extends React.Component {
      render() {
          let { radius, style } = this.props;

          if (!geojson) {
              return (null) // as per React docs
          }

          // get radius from parent, or is it above 100 markers? 2 else 8
          radius = radius ? radius : geojson.features && geojson.features.length > 100 ? 2 : 8

          if(!geojson.features || geojson.type !== "FeatureCollection") {
              if(geojson.coordinates) { //single feature.
                  return(
                  <GeoJSON //react-leaflet component
                      key={JSON.stringify(geojson)}
                      data={geojson}
                  />
                  )
              } else {
                  return(null) //nothing is passed to me.
              }
          }
          // we have type: "FeatureCollection"
          return (
              geojson.features.map((feature, i) => {
                  return (
                      <GeoJSON //react-leaflet component
                          key={JSON.stringify(feature) + radius}
                          // gp_add_geojson can define values from `feature`
                          style={typeof(style) === 'function' ?
                          style(feature) : style }
                          /**
                           * https://leafletjs.com/examples/geojson/
                           * style for leaflet is
                           * {"color": "#hexstr", "weight": 5, "opacity": 0.65}
                           * or of course a function returning these.
                           */
                          data={feature}
                          onEachFeature={(feature, layer) => {
                              const properties = Object.keys(feature.properties).map((key) => {
                                  return (key + " : " + feature.properties[key])
                              })
                              layer.bindPopup(
                                  properties.join('<br/>')
                              );
                          }}
                          pointToLayer={
                              // use cricles prop if not 10 markers is enough
                              this.props.circle || geojson.features.length > 10 ?
                                  (_, latlng) => {
                                      // Change the values of these options to change the symbol's appearance
                                      let options = {
                                          radius: radius,
                                          fillColor: "green",
                                          color: "black",
                                          weight: 1,
                                          opacity: 1,
                                          fillOpacity: 0.8
                                      }
                                      return L.circleMarker(latlng, options);
                                  }
                                  :
                                  (_, latlng) => {
                                      return L.marker(latlng);
                                  }
                          }
                      />
                  )
              })
          )}
      }
      const geojsonLayer = L.geoJson(geojson)      
      const bbox = geojsonLayer.getBounds()
      const position = bbox.getSouthWest() ? bbox.getCenter() : [53.8078, -1.5534]      
      const Geoplumber = () => (
        <Map 
          bounds={bbox.getSouthWest() ? bbox : [position, [52.78,-1.65]]}
          center={position} >
          <TileLayer
            attribution='&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
            url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
          />
          <GeoJSONComponent />
        </Map>
      )      
      window.ReactDOM.render(<Geoplumber />, document.getElementById('container'))
    </script>
  </body>
</html>
